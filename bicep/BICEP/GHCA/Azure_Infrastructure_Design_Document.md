# Azure Infrastructure - Bicep ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå…¨ä½“è¨­è¨ˆæ›¸

## ğŸ“‹ æ¦‚è¦

æœ¬è¨­è¨ˆæ›¸ã¯ã€Azureç’°å¢ƒã®åŒ…æ‹¬çš„ãªã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚’Bicepãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚°ãƒ¬ãƒ¼ãƒ‰ã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚Hub-Spokeãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ¡ç”¨ã—ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã€ç›£è¦–ã€ã‚¬ãƒãƒŠãƒ³ã‚¹ã®æœ€é©åŒ–ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

### ğŸ¯ è¨­è¨ˆç›®æ¨™
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**: Azure Firewallã€NSGã€Bastion ã«ã‚ˆã‚‹ã‚¼ãƒ­ãƒˆãƒ©ã‚¹ãƒˆ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: Hub-Spoke ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã‚ˆã‚‹æ‹¡å¼µæ€§
- **é‹ç”¨åŠ¹ç‡**: Azure Monitorã€Log Analytics ã«ã‚ˆã‚‹ä¸€å…ƒç›£è¦–
- **ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹**: RBACã€è¨ºæ–­è¨­å®šã€ãƒªã‚½ãƒ¼ã‚¹ãƒ­ãƒƒã‚¯ã«ã‚ˆã‚‹ã‚¬ãƒãƒŠãƒ³ã‚¹

---

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         HUB VNET                                â”‚
â”‚                     (192.168.0.0/16)                           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Azure Firewallâ”‚  â”‚ Azure Bastion â”‚  â”‚  App Gateway  â”‚       â”‚
â”‚  â”‚ (192.168.0.0/ â”‚  â”‚ (192.168.1.0/ â”‚  â”‚ (192.168.3.0/ â”‚       â”‚
â”‚  â”‚     /26)      â”‚  â”‚     /26)      â”‚  â”‚     /24)      â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚  Gateway      â”‚  â”‚  DNS Server   â”‚                          â”‚
â”‚  â”‚  Subnet       â”‚  â”‚  Subnet       â”‚                          â”‚
â”‚  â”‚ (192.168.2.0/ â”‚  â”‚ (192.168.4.0/ â”‚                          â”‚
â”‚  â”‚     /27)      â”‚  â”‚     /26)      â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ VNet Peering
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       SPOKE VNET                               â”‚
â”‚                     (172.16.0.0/16)                           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                VM Subnet                                  â”‚ â”‚
â”‚  â”‚              (172.16.0.0/22)                             â”‚ â”‚
â”‚  â”‚                                                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ â”‚
â”‚  â”‚  â”‚   VM    â”‚  â”‚   VM    â”‚  â”‚   VM    â”‚  â”‚   ...   â”‚     â”‚ â”‚
â”‚  â”‚  â”‚   #1    â”‚  â”‚   #2    â”‚  â”‚   #3    â”‚  â”‚         â”‚     â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

### ğŸš€ ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ

| ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ | å½¹å‰² |
|---------|-----|------|
| `getStart.bicep` | ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ | Key Vaultä½œæˆå¾Œã€main.bicepã‚’å‘¼ã³å‡ºã— |
| `main.bicep` | ä¸»è¦ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ | å…¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä¾å­˜é–¢ä¿‚ã‚’ç®¡ç† |

### ğŸ”§ ã‚³ã‚¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

| ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« | ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ | ãƒªã‚½ãƒ¼ã‚¹ |
|-----------|---------|-----|---------|
| **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åŸºç›¤** | `vnet-hub.bicep` | Hubä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ | VNet, ã‚µãƒ–ãƒãƒƒãƒˆ, NSG |
| | `vnet-spoke.bicep` | Spokeä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ | VNet, ã‚µãƒ–ãƒãƒƒãƒˆ, ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ« |
| | `vnetpeering.bicep` | VNetãƒ”ã‚¢ãƒªãƒ³ã‚° | Hub-Spokeæ¥ç¶š |
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** | `azfw.bicep` | Azure Firewall | ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«, ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯/ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ« |
| | `bastion.bicep` | Azure Bastion | ã‚»ã‚­ãƒ¥ã‚¢ãªRDP/SSHæ¥ç¶š |
| | `appgw.bicep` | Application Gateway | WAF, è² è·åˆ†æ•£ |
| **ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆ** | `vm.bicep` | ä»®æƒ³ãƒã‚·ãƒ³ | VM, ãƒ‡ã‚£ã‚¹ã‚¯, æ‹¡å¼µæ©Ÿèƒ½ |
| **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸** | `storageaccount.bicep` | ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ | Blob, è¨ºæ–­ãƒ­ã‚° |
| **ç›£è¦–** | `law.bicep` | Log Analytics | ãƒ­ã‚°åé›†, ã‚¢ãƒ©ãƒ¼ãƒˆ |
| | `ampls.bicep` | Private Link Scope | ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆç›£è¦– |
| | `diagnostic.bicep` | è¨ºæ–­è¨­å®š | ãƒ¡ãƒˆãƒªã‚¯ã‚¹, ãƒ­ã‚°å‡ºåŠ› |
| **ã‚¬ãƒãƒŠãƒ³ã‚¹** | `rbac.bicep` | ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ | æ¨©é™ç®¡ç† |
| | `lock.bicep` | ãƒªã‚½ãƒ¼ã‚¹ãƒ­ãƒƒã‚¯ | å‰Šé™¤ä¿è­· |
| | `nsgflowlog.bicep` | NSGãƒ•ãƒ­ãƒ¼ãƒ­ã‚° | ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç›£è¦– |

---

## ğŸ” Key Vault è¨­å®š

### åŸºæœ¬æ§‹æˆ
```json
{
  "name": "keyv{uniqueString}",
  "sku": "standard",
  "tenantId": "{subscription().tenantId}",
  "enableSoftDelete": true,
  "enablePurgeProtection": true
}
```

### ã‚¢ã‚¯ã‚»ã‚¹ãƒãƒªã‚·ãƒ¼
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚»ã‚¹**: `keyvault-user.json`ã§å®šç¾©
- **æ¨©é™**: Keys, Secrets, Certificates, Storage ã®å®Œå…¨ã‚¢ã‚¯ã‚»ã‚¹
- **VMç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰**: `keyvault-pass.json`ã‹ã‚‰å–å¾—

---

## ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­è¨ˆ

### Hub Virtual Network (192.168.0.0/16)

| ã‚µãƒ–ãƒãƒƒãƒˆ | CIDR | ç”¨é€” | ç‰¹è¨˜äº‹é … |
|-----------|------|------|---------|
| AzureFirewallSubnet | 192.168.0.0/26 | Azure Firewall | å›ºå®šåå¿…é ˆ |
| AzureBastionSubnet | 192.168.1.0/26 | Azure Bastion | å›ºå®šåå¿…é ˆ |
| GatewaySubnet | 192.168.2.0/27 | VPN/ExpressRoute Gateway | å›ºå®šåå¿…é ˆ |
| AppGwSubnet | 192.168.3.0/24 | Application Gateway | WAFçµ±åˆ |
| DnsHubSubnet | 192.168.4.0/26 | DNS ã‚µãƒ¼ãƒãƒ¼ | ã‚«ã‚¹ã‚¿ãƒ DNS |

### Spoke Virtual Network (172.16.0.0/16)

| ã‚µãƒ–ãƒãƒƒãƒˆ | CIDR | ç”¨é€” | ç‰¹è¨˜äº‹é … |
|-----------|------|------|---------|
| VmSubnet | 172.16.0.0/22 | ä»®æƒ³ãƒã‚·ãƒ³ | 1,024 IP ã‚¢ãƒ‰ãƒ¬ã‚¹ |

---

## ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### Azure Firewall è¨­å®š

#### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ«ãƒ¼ãƒ«
```json
{
  "ruleCollections": [
    {
      "name": "AzureFirewallNetworkRuleCollection",
      "rules": "default-azfw-nwrule.json"
    }
  ]
}
```

#### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«
```json
{
  "ruleCollections": [
    {
      "name": "AzureFirewallApplicationRuleCollection", 
      "rules": "default-azfw-apprule.json"
    }
  ]
}
```

### Network Security Groups

#### Hub NSG (DNS)
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ«ãƒ¼ãƒ«**: `default-rule-hub-nsg.json`
- **ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«**: DNSé€šä¿¡ç”¨ç‰¹åˆ¥ãƒ«ãƒ¼ãƒ«

#### Spoke NSG
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ«ãƒ¼ãƒ«**: `default-rule-spoke-nsg.json`
- **VMé€šä¿¡**: HubçµŒç”±ã§ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹

### Azure Bastion
- **SKU**: Standard
- **æ©Ÿèƒ½**: ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå¯¾å¿œ
- **ã‚¢ã‚¯ã‚»ã‚¹**: HTML5ãƒ–ãƒ©ã‚¦ã‚¶çµŒç”±

---

## ğŸ’» ä»®æƒ³ãƒã‚·ãƒ³è¨­è¨ˆ

### VMä»•æ§˜
```json
{
  "vmSize": "Standard_D2s_v3",
  "osDisk": {
    "storageAccountType": "Premium_LRS",
    "diskSizeGB": 127
  },
  "dataDisk": {
    "storageAccountType": "Premium_LRS", 
    "diskSizeGB": 256
  }
}
```

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
- **ç®¡ç†è€…èªè¨¼**: Key Vault ã‹ã‚‰ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å–å¾—
- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹**: Bastion çµŒç”±ã®ã¿
- **æš—å·åŒ–**: Azure Disk Encryption å¯¾å¿œ

---

## ğŸ“Š ç›£è¦–ãƒ»ãƒ­ã‚°è¨­è¨ˆ

### Log Analytics Workspace
```json
{
  "sku": "PerGB2018",
  "retentionInDays": 730,
  "features": {
    "enableLogAccessUsingOnlyResourcePermissions": true
  }
}
```

### Azure Monitor Private Link Scope (AMPLS)
- **ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: Hub VNetå†…
- **DNSçµ±åˆ**: ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆDNSã‚¾ãƒ¼ãƒ³
- **å¯¾è±¡ã‚µãƒ¼ãƒ“ã‚¹**: Log Analytics, Application Insights

### è¨ºæ–­è¨­å®š
| ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ— | ãƒ­ã‚°ã‚«ãƒ†ã‚´ãƒª | ãƒ¡ãƒˆãƒªã‚¯ã‚¹ |
|--------------|-------------|-----------|
| Virtual Network | AllLogs | AllMetrics |
| Azure Firewall | AzureFirewallApplicationRule, AzureFirewallNetworkRule | AllMetrics |
| Storage Account | StorageRead, StorageWrite, StorageDelete | Transaction |
| Virtual Machine | - | AllMetrics |

---

## ğŸ”’ RBACè¨­è¨ˆ

### ã‚¹ã‚³ãƒ¼ãƒ—ãƒ™ãƒ¼ã‚¹RBAC (`ScopeModules/Rbac/`)

| ãƒªã‚½ãƒ¼ã‚¹ | ãƒ­ãƒ¼ãƒ« | ãƒ•ã‚¡ã‚¤ãƒ« |
|---------|--------|---------|
| Hub VNet | Network Contributor | `rbac-hubvnet.bicep` |
| Spoke VNet | Network Contributor | `rbac-spokevnet.bicep` |
| Azure Firewall | Network Contributor | `rbac-azfw.bicep` |
| Bastion | Bastion Operator | `rbac-bastion.bicep` |
| Application Gateway | Application Gateway Contributor | `rbac-appgw.bicep` |
| Key Vault | Key Vault Administrator | `rbac-keyvault.bicep` |
| Storage Account | Storage Blob Data Contributor | `rbac-stracc.bicep` |
| Virtual Machine | Virtual Machine Contributor | `rbac-vm.bicep` |
| Log Analytics | Log Analytics Contributor | `rbac-law.bicep` |

### ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©
å„RBACãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯å¯¾å¿œã™ã‚‹JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å–å¾—ï¼š
- `hubvnet-user.json`, `spokevnet-user.json`, `azfw-user.json` ãªã©

---

## ğŸ·ï¸ ã‚¿ã‚°æˆ¦ç•¥

ã™ã¹ã¦ã®ãƒªã‚½ãƒ¼ã‚¹ã«çµ±ä¸€ã‚¿ã‚°ã‚’é©ç”¨ï¼š

```json
{
  "CostCenterNumber": "10181378",
  "CreateDate": "2023/03/23", 
  "Location": "japaneast",
  "Owner": "akkoike"
}
```

---

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæ‰‹é †

### å‰ææ¡ä»¶
1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š**: `keyvault-user.json`ã«Object IDã‚’è¨­å®š
2. **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®š**: `keyvault-pass.json`ã«VMç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®š
3. **RBACãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š**: å„`*-user.json`ãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’è¨­å®š

### ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆé †åº
```bash
# 1. ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆå®Ÿè¡Œ
az deployment group create \
  --resource-group <your-rg> \
  --template-file getStart.bicep

# 2. è‡ªå‹•çš„ã«ä»¥ä¸‹ã®é †åºã§ãƒ‡ãƒ—ãƒ­ã‚¤
# getStart.bicep
#   â””â”€â”€ main.bicep
#       â”œâ”€â”€ vnet-hub.bicep
#       â”œâ”€â”€ azfw.bicep (depends: vnet-hub)
#       â”œâ”€â”€ vnet-spoke.bicep (depends: azfw)
#       â”œâ”€â”€ vnetpeering.bicep (depends: vnet-hub, vnet-spoke)
#       â”œâ”€â”€ appgw.bicep (depends: vnet-hub)
#       â”œâ”€â”€ bastion.bicep (depends: vnet-hub)
#       â”œâ”€â”€ ampls.bicep (depends: vnet-hub)
#       â”œâ”€â”€ vm.bicep (depends: vnet-spoke, key-vault)
#       â”œâ”€â”€ storageaccount.bicep
#       â”œâ”€â”€ diagnostic.bicep
#       â”œâ”€â”€ rbac.bicep
#       â””â”€â”€ lock.bicep
```

---

## ğŸ”§ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒã‚¤ãƒ³ãƒˆ

### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š
- **Hub VNet CIDR**: `VNET_HUB_ADDRESS_SPACE` (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 192.168.0.0/16)
- **Spoke VNet CIDR**: `VNET_SPOKE_ADDRESS_SPACE` (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 172.16.0.0/16)
- **è¿½åŠ ã‚µãƒ–ãƒãƒƒãƒˆ**: å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§è¿½åŠ å¯èƒ½

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«
- **ã‚«ã‚¹ã‚¿ãƒ NSGãƒ«ãƒ¼ãƒ«**: å„`*-nsg.json`ãƒ•ã‚¡ã‚¤ãƒ«ã§å®šç¾©
- **Firewallãƒ«ãƒ¼ãƒ«**: `default-azfw-*.json`ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†
- **WAFãƒãƒªã‚·ãƒ¼**: Application Gateway ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§è¨­å®š

### ç›£è¦–è¨­å®š
- **ãƒ­ã‚°ä¿æŒæœŸé–“**: Log Analytics Workspaceè¨­å®š
- **ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†**: è¨ºæ–­è¨­å®šã§èª¿æ•´
- **ã‚¢ãƒ©ãƒ¼ãƒˆ**: å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§å€‹åˆ¥è¨­å®š

---

## ğŸ“ˆ é‹ç”¨è€ƒæ…®äº‹é …

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- **Azure Firewall**: Premium SKUæ¨å¥¨ï¼ˆæœ¬æ ¼é‹ç”¨æ™‚ï¼‰
- **VM ã‚µã‚¤ã‚º**: ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã«å¿œã˜ã¦èª¿æ•´
- **Storage**: Premium SSDæ¨å¥¨

### å¯ç”¨æ€§
- **å¯ç”¨æ€§ã‚¾ãƒ¼ãƒ³**: è¤‡æ•°ã‚¾ãƒ¼ãƒ³å±•é–‹å¯¾å¿œ
- **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: Azure Backupçµ±åˆ
- **ç½å®³å¾©æ—§**: ASRï¼ˆAzure Site Recoveryï¼‰é€£æº

### ã‚³ã‚¹ãƒˆæœ€é©åŒ–
- **ãƒªã‚½ãƒ¼ã‚¹è‡ªå‹•åœæ­¢**: VMè‡ªå‹•ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸éšå±¤**: Blobã‚¢ã‚¯ã‚»ã‚¹å±¤æœ€é©åŒ–
- **äºˆç´„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹**: é•·æœŸåˆ©ç”¨ãƒªã‚½ãƒ¼ã‚¹

---

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ä¸€èˆ¬çš„ãªå•é¡Œ
1. **Key Vault ã‚¢ã‚¯ã‚»ã‚¹**: Object IDè¨­å®šç¢ºèª
2. **NSG ãƒ«ãƒ¼ãƒ«**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ«ãƒ¼ãƒ«ç¢ºèª
3. **DNS è§£æ±º**: ã‚«ã‚¹ã‚¿ãƒ DNSè¨­å®šç¢ºèª
4. **ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**: Azure FirewallçµŒç”±ç¢ºèª

### ç›£è¦–ãƒã‚¤ãƒ³ãƒˆ
- **Azure Firewall ãƒ­ã‚°**: ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸé€šä¿¡
- **NSG ãƒ•ãƒ­ãƒ¼ãƒ­ã‚°**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯
- **VM è¨ºæ–­**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ ãƒ¡ãƒˆãƒªã‚¯ã‚¹
- **Storage åˆ†æ**: ã‚¢ã‚¯ã‚»ã‚¹ ãƒ‘ã‚¿ãƒ¼ãƒ³

---

## ğŸ“ å¤‰æ›´å±¥æ­´

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | å¤‰æ›´å†…å®¹ | ä½œæˆè€… |
|-----------|------|---------|--------|
| 1.0 | 2023/03/23 | åˆç‰ˆä½œæˆ | akkoike |
| 1.1 | 2025/10/20 | è¨­è¨ˆæ›¸çµ±åˆã€RBACè©³ç´°åŒ– | AI Assistant |

---

ã“ã®è¨­è¨ˆæ›¸ã¯ã€Bicepãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ã‚ˆã‚‹ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºã‚°ãƒ¬ãƒ¼ãƒ‰ã®Azureã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£æ§‹ç¯‰ã®åŒ…æ‹¬çš„ãªã‚¬ã‚¤ãƒ‰ã§ã™ã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã€ç›£è¦–ã€ã‚¬ãƒãƒŠãƒ³ã‚¹ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’çµ±åˆã—ã€ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ã§ä¿å®ˆå¯èƒ½ãªã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æä¾›ã—ã¾ã™ã€‚